#summary Les alertes du script « save-logged-user-in-database.pl »

= Introduction =

Le script « _save-logged-user-in-database.pl_ » permet de déclencher certaines alertes. Une alerte est soit un message _XMPP_ ou soit un message envoyé à l'utilisateur connecté.

Des alertes peuvent-être déclenchées en analysant les propriétés des utilisateurs connectés, par exemple on peut déclencher une alerte si l'utilisateur avec le pseudo « _Laws_ » se connecte, ou si un pseudo femme de trente ans se connecte, ou encore si un pseudo se connecte avec un code de vote « _MYY_ ». 

L'option « -A » du « _save-logged-user-in-database.pl » active la fonction des alertes et le fichier « conf/alert.conf » est utilisé.

== La section `<alert>` ==

Le fichier « _alert.conf_ » comporte la section `<alert>` pour déclarer une nouvelle alerte.

Exemple :
{{{
  <alert>
      enable    = 1
      condition = $mynickname eq 'Laws'
      transport = XMPP
      recipient = cocoxmpp
  </alert>
 }}}

Dans cette exemple une alarme de type _XMPP_ est déclenché si un pseudonyme « _Laws_ » est connecté.

Les différentes directives sont :
  * enable :  « 1 » l'alerte est activée ou « 0 » elle est désactivée.
  * condition : condition requise pour que l'alerte soit prise en compte. Les conditions sont du code Perl. Plusieurs directives _condition_ peuvent exister, il suffit qu'une soit vraie pour que l'alerte soit déclenchée.
  * transport : type d'alerte _XMPP_ ou _Message_.
  * recipient : gestionnaire de l'alerte.


=== Les conditions ===

Les directives conditions utilisent les propriétés de l'objet _Cocoweb::user_ :
  * mynickname : Le pseudonyme 
  * myage : l'âge
  * mysex : Le sexe : 1 ou 6 pour un homme, 2 ou 7 pour une femme
  * citydio : le code spécifique correspondant au code postal
  * myver : 4 si l'utilisateur dispose d'un abonnement Premium 
  * isNew : 1 si c'est un nouvel utilisateur  
  * hasChange : 1 si le pseudo s'est reconnecté en changeant certaines propriétés, comme le pseudo, l'âge, le sexe, ...

Plusieurs directives _condition_ peuvent se suivre. L'alerte est déclenchée si au moins une des directives _condition_ est vraie.

Exemple l'alerte sera déclenchée si un utilisateur avec le pseudonyme femme « _Laws_ » ou un utilisateur avec le code de vote « _uhy_ » se connecte :
{{{
 condition = $mynickname eq 'Laws' and ($mysex eq "2" or $mysex eq "7")
 condition = $code eq 'uhy'
}}}


== La section `<alert>` ==

